- [数组内存分配原理](#数组内存分配原理)
  - [运行时数组内存分配](#运行时数组内存分配)
  - [总结](#总结)


# 数组内存分配原理
数组是**内存中一片连续的区域**,声明时需要指定长度

## 运行时数组内存分配
数组是内存区域一块连续的存储空间.

在运行时会通过`mallocgc`给数组分配具体存储空间

`newarray`中元素只有一个,则空间大小为元素类型的大小`typ.size`, 如果多个则是 `n*typ.size`.

**但这并不是实际分配的内存大小**, 还是取决于运行时`mallocgc`, 如果待分配对象不超过`32kb`,`mallocgc`会直接将其分配在缓存空间中`,如果大于就从堆区分配内存空间

## 总结
**数组在编译阶段最终解析为`types.Array`类型, 包含元素类型`Elem`和数组长度`Bound`
```golang
type Array struct {
    Elem *Type
    Bound int64
}
```
1. 如果数组长度未指定，例如使用了语法糖[...]，则会在表达式类型检查时计算出数组长度。
2. 数组字面量初始化以及索引越界检查都是在编译时类型检查阶段完成的。
3. 在运行时通过newarray()函数对数组内存进行分配，如果数组大小超过32kb则会直接分配到堆区内存。
