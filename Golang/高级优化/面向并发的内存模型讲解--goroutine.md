- [`Goroutine`和系统线程](#goroutine和系统线程)
  - [系统级线程:](#系统级线程)
  - [`Goroutine`](#goroutine)
    - [包含自己的调度器](#包含自己的调度器)

# `Goroutine`和系统线程

> 栈用于保存函数递归调用时的参数和局部变量

## 系统级线程:

*   每个系统级线程都会有一个固定大小的栈(一般2MB)
*   对于需要很小栈空间的线程,会造成巨大浪费
*   对于需要很多栈空间线程来说,会面临栈溢出风险

## `Goroutine`

*   以很小的栈启动(可能是2KB或者4KB), 起始空间少, 启动代价低,可以轻易启动上万个
*   当深度递归导致栈空间不足时, 会动态伸缩栈大小

### 包含自己的调度器

可以在`n`个操作系统线程上调度`m`个`Goroutine`,调度器只关注单独的`Go`程序中的`Goroutine`

*   **采用半抢占式协作调度, 只有在当前`Goroutine`发生阻塞时才会导致调度**
*   发生在**用户态**,调度器会根据具体函数**只保存必要的寄存器**, --- 切换代价要比系统线程低得多
*   运行时有一个`runtime.GOMAXPROCS`变量,用于**控制当前运行正常非阻塞**`Goroutine`的**系统线程数目**

